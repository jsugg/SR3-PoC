!function(){"use strict";const e="https://localhost:4443";var t=!1,a=!1;async function n(e,t,a){let n=0,o=a;for(;n<t;){try{const t=await fetch(e,{mode:"no-cors"});if(t.ok)return await t.json();console.error(`Request failed. Retrying attempt ${n+1}`)}catch(e){console.error(`Request failed. Retrying attempt ${n+1}: ${e.message}`)}o*=2,await new Promise((e=>setTimeout(e,o))),n++}throw new Error("Request failed after multiple retries.")}function o(e,t="defer"){return new Promise((function(a,n){const o=document.createElement("script");o.src=e,"defer"===t&&(o.async=!1),"async"===t&&(o.async=!0),o.addEventListener("load",(function(){a()})),o.addEventListener("error",(function(){n(new Error("Failed to load script: "+e))})),document.head.appendChild(o)}))}function s(e){return $.ajax({url:e,dataType:"json"})}function i(e){return new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0,currencyDisplay:"symbol"}).format(e)}document.addEventListener("DOMContentLoaded",(function(){document.addEventListener("responsiveNavbarNeeded",(function(){!function(){const e=document.querySelector("a.icon"),t=document.getElementById("navigationBar");e&&"none"!==e.style.display&&("navbar"===t.className?t.className+=" responsive":t.className="navbar")}()})),document.getElementById("hamburger").onclick=function(){document.dispatchEvent(new Event("responsiveNavbarNeeded"))}}));function r(e){new Swiper("#"+e,{spaceBetween:150,slidesPerView:"1",loop:!0,centeredSlides:!0,grabCursor:!0,navigation:{nextEl:`#${e}-next`,prevEl:`#${e}-prev`},pagination:{el:`#${e}-pagination`,clickable:!0},autoplay:{delay:3e3,disableOnInteraction:!1},zoom:{maxRatio:1.2,minRation:1}}),console.log(`Initialized swiper ${e}`)}async function l(){let e=t.values;for(const[t,a]of e.entries())try{const e=document.getElementById(a[0]);"macaques"===a[0]?e.style.backgroundImage=`url("${a[1]}")`:e.setAttribute("src",a[1])}catch(e){console.error(`Error unpacking assets bundle: ${e}`)}}async function d(){let e=a,t=1/0,o=0;e.headerRow[1];const s=e.values;let l=[...new Set(s.map((e=>e[1])))],d=[...l];function c(e=null,t=null){const a=e?e[0]:null,n=e?e[1]:null;$(".informationBlock").each((function(){const o=parseFloat($(this).data("fee")),s=$(this).data("location"),i=(!t||d.includes(s))&&(!e||o>=a&&o<=n);$(this).toggle(i)}))}$("#informationBlocks").addClass("flex-container");for(const[e,a]of s.entries()){let s=$("<div>").addClass("informationBlock flex-item block");s.addClass(a[1]),s.attr("data-fee",1e3*parseFloat(a[0].replace(/[^0-9.-]+/g,""))),s.attr("data-location",a[1]);let l=$("<div>").addClass("details");l.append("<h2>"+a[3]+"</h2>"),l.append("<h3>"+i(1e3*parseFloat(a[0].replace(/[^0-9.-]+/g,"")))+"</h3>"),l.append("<p>"+a[1]+"</p>"),l.append("<p>"+('<a href="tel:'+(u=a[2])+'">'+u+"</a></p>")),l.append("<p>"+(p=a[4],p.split("\n").map((e=>`<p>${e}</p>`)).join("")).replace(/\n/g,"<br>")+"</p>"),a[2].split(",").forEach((function(e){e=e.trim(),l.append("<a style='text-decoration: none' href='https://api.whatsapp.com/send?phone="+e.replace(/\s/g,"")+"&text=Hola!%20Te%20llamo%20por%20el%20aviso%20de%20OMacaco%20Sitio%20Partner%20de%20La%20Estokada'><img src='https://cdn-icons-png.flaticon.com/64/3025/3025546.png' alt='Whatsapp' title='Whatsapp' target='_blank' width='70' height='70'/></a>")})),l.append(`<p><a style='text-decoration: none;' href='${a[6]}' target="_blank">ðŸ”—</a></p>`);let d="swiper-container-"+e,c=$("<div>").addClass("swiper-container").attr("id",d),m=$("<div>").addClass("swiper-wrapper"),f=$("<div>").addClass("swiper-pagination").attr("id",`${d}-pagination`),h=$("<div>").addClass("swiper-button-next").attr("id",`${d}-next`),g=$("<div>").addClass("swiper-button-prev").attr("id",`${d}-prev`),[y]=a[5];y=y?y.split(","):null,console.log(`Index ${e}. Typeof images: ${typeof y}, images: ${y}`),y&&Array.isArray(y)?y.forEach((async function(t){if(t){if(null!=(t=await n(t,3,1e3).then((e=>e||null)).catch((e=>{console.error("Request failed:",e)})))){let a=$("<div>").addClass("swiper-slide");a.append("<img src='"+t+"' style='width: 100%; height: auto; bottom: 0;' alt='Carousel Photo'>"),m.append(a),console.log(`Photo ${e}: ${t} added to the carousel`)}}else console.log("No photo found for row: "+e)})):console.log(`no luck with photos for row ${e}`);let v=$("<div>").addClass("mainPhoto"),w=!1,E=a[5];for(;Array.isArray(E)&&E.length>0&&!w;)w=!!E[0]&&E[0],E.shift();w=w||"",v.append(`<img src='${w}' height='300' alt='Main Photo'>`),c.append(m,f,h,g);let b=$("<div>").addClass("swiper-container-wrapper");b.append(c),s.append(v,l,b),$("#informationBlocks").append(s),r(d);let x=a[1],C=1e3*parseFloat(a[0].replace(/[^0-9.-]+/g,""));C<t&&(t=C),C>o&&(o=C),s.data("fee",C),s.data("location",x),s.show()}var p,u;let m=document.getElementById("rangeSliders"),f=document.getElementById("feeRangeDisplay");document.getElementById("spinner").style.display="none";const h=noUiSlider.create(m,{start:[t,o],connect:!0,step:5e3,range:{min:t,max:o}});f.innerText=i(t)+" - "+i(o),h.on("update",(function(e,t){parseInt(e[t]),f.innerText=i(parseInt(e[0]))+" - "+i(parseInt(e[1])),c([e[0],e[1]],null)})),l.forEach((function(e){let t=$("<button>").addClass("filterButton active").text(e).attr("data-location",e);t.click((function(){$(this).toggleClass("active");const e=$(this).data("location"),t=d.indexOf(e);-1!==t?d.splice(t,1):d.push(e),c(null,e)})),$("#locationFilter").append(t)}))}o("js/swiper-bundle.min.js","async"),o("js/nouislider.min.js","async"),$((()=>{document.addEventListener("dataLoaded",d),document.addEventListener("assetsLoaded",l),s(`${e}/assets`).then((e=>{t=e,document.dispatchEvent(new Event("assetsLoaded"))})).fail((e=>{console.error("Failed to load assets:",e)})),$(document).ajaxStop((function t(){$(document).off("ajaxStop",t),s(`${e}/data`).then((e=>{a=e,document.dispatchEvent(new Event("dataLoaded"))})).fail((e=>{console.error("Failed to load data:",e)}))}))}))}();
